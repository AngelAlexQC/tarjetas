# ========================================
# SonarCloud Configuration for Financiero
# React Native / Expo / TypeScript
# ========================================

# Identificación del proyecto
sonar.projectKey=AngelAlexQC_financiero
sonar.organization=angelalexqc
sonar.projectName=Financiero App
sonar.projectVersion=1.0.0

# ========================================
# Fuentes y Exclusiones
# ========================================

# Directorios con código fuente a analizar
sonar.sources=app,components,contexts,hooks,repositories,utils,constants,api

# Exclusiones globales (no analizar)
sonar.exclusions=\
  **/node_modules/**,\
  **/coverage/**,\
  **/.expo/**,\
  **/android/**,\
  **/ios/**,\
  **/dist/**,\
  **/build/**,\
  **/*.test.ts,\
  **/*.test.tsx,\
  **/*.spec.ts,\
  **/*.spec.tsx,\
  **/__tests__/**,\
  **/__mocks__/**,\
  **/test-utils/**,\
  **/assets/**,\
  **/*.config.js,\
  **/*.config.ts,\
  **/scripts/**,\
  **/*.d.ts,\
  **/expo-env.d.ts

# Archivos de test (para métricas de tests, no para bugs)
# IMPORTANTE: Mantener separados de sources para que no cuenten como código a testear
sonar.tests=.
sonar.test.inclusions=\
  **/*.test.ts,\
  **/*.test.tsx,\
  **/*.spec.ts,\
  **/*.spec.tsx,\
  **/__tests__/**

# ========================================
# Cobertura de código (Jest/LCOV)
# ========================================

# IMPORTANTE: sonar.javascript.lcov.reportPaths funciona para JS y TS
# sonar.typescript.lcov.reportPaths está DEPRECATED - NO usar
sonar.javascript.lcov.reportPaths=coverage/lcov.info

# ========================================
# Configuración de lenguaje
# ========================================

sonar.sourceEncoding=UTF-8

# ========================================
# Memoria y Rendimiento
# ========================================

# Aumentar memoria para análisis de proyectos medianos/grandes
# Valor en MB (4096 = 4GB)
sonar.javascript.node.maxspace=4096

# ========================================
# Quality Gate - Umbrales progresivos
# ========================================

# Cobertura: excluir archivos que no deben ser testeados
sonar.coverage.exclusions=\
  **/*.test.ts,\
  **/*.test.tsx,\
  **/*.spec.ts,\
  **/*.spec.tsx,\
  **/__tests__/**,\
  **/__mocks__/**,\
  **/test-utils/**,\
  **/*.d.ts,\
  **/types/**,\
  **/*.types.ts,\
  **/index.ts,\
  **/index.tsx,\
  app/_layout.tsx,\
  app/+not-found.tsx,\
  constants/**,\
  **/interfaces/**,\
  **/*.interface.ts

# Duplicación: máximo 3% de líneas duplicadas
sonar.cpd.exclusions=\
  **/*.test.ts,\
  **/*.test.tsx,\
  **/__tests__/**,\
  **/constants/**,\
  **/*.interface.ts

# Tamaño de archivo: advertir en archivos > 500 líneas
# (Los archivos muy grandes son difíciles de mantener)

# Complejidad ciclomática: máximo 15 por función
# (Funciones muy complejas son difíciles de testear)

# Extensiones de archivo a analizar
sonar.javascript.file.suffixes=.js,.jsx
sonar.typescript.file.suffixes=.ts,.tsx

# ========================================
# Ignorar Issues Específicos por Regla y Patrón
# ========================================

# Configuración para ignorar reglas específicas en archivos de tipo específico
# Formato: sonar.issue.ignore.multicriteria=KEY1,KEY2,KEY3...
# Para cada KEY:
#   sonar.issue.ignore.multicriteria.KEY.ruleKey = regla a ignorar
#   sonar.issue.ignore.multicriteria.KEY.resourceKey = patrón de archivos

# IMPORTANTE: Definir TODAS las claves en una sola línea
sonar.issue.ignore.multicriteria=\
  mock1,\
  mock2,\
  mock5,\
  readonly1,\
  readonly2,\
  cognitive1,\
  cyclomatic1,\
  unusedprops1,\
  emptyinterface1,\
  ternary1,\
  ternary2,\
  constants1,\
  layoutfiles1,\
  svgicons1,\
  deprecated1,\
  deprecated2,\
  zerofraction1,\
  fragmentredundant1,\
  assertion1,\
  useState1

# MOCK DATA: Ignorar Math.random() en archivos mock (S2245)
# Los archivos de producción ahora usan crypto.getRandomValues() para seguridad
sonar.issue.ignore.multicriteria.mock1.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.mock1.resourceKey=**/*mock*.ts

# MOCK DATA: Ignorar Math.random() en generadores de datos de prueba
sonar.issue.ignore.multicriteria.mock2.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.mock2.resourceKey=**/insurance-generator.ts

# NOTA: Las pantallas de producción (advance, cardless-atm, defer, pay) ahora usan
# generateSecureReceiptId() con crypto.getRandomValues() - ya no requieren excepciones

sonar.issue.ignore.multicriteria.mock5.ruleKey=typescript:S2245
sonar.issue.ignore.multicriteria.mock5.resourceKey=app/cards/**/cvv.tsx

# Props readonly en componentes React (S6759) - Muy estricto para React Native
# React Native no requiere readonly en props - falso positivo común
sonar.issue.ignore.multicriteria.readonly1.ruleKey=typescript:S6759
sonar.issue.ignore.multicriteria.readonly1.resourceKey=components/**/*.tsx

# Props readonly en screens (S6759)
sonar.issue.ignore.multicriteria.readonly2.ruleKey=typescript:S6759
sonar.issue.ignore.multicriteria.readonly2.resourceKey=app/**/*.tsx

# Complejidad cognitiva en componentes UI (S3776) - Aceptable en componentes de UI
sonar.issue.ignore.multicriteria.cognitive1.ruleKey=typescript:S3776
sonar.issue.ignore.multicriteria.cognitive1.resourceKey=components/**/*.tsx

# Complejidad ciclomática en screens (S1541) - Componentes complejos de navegación
sonar.issue.ignore.multicriteria.cyclomatic1.ruleKey=typescript:S1541
sonar.issue.ignore.multicriteria.cyclomatic1.resourceKey=app/**/*.tsx

# Props no usadas - Falsos positivos con spread operator (S6767)
sonar.issue.ignore.multicriteria.unusedprops1.ruleKey=typescript:S6767
sonar.issue.ignore.multicriteria.unusedprops1.resourceKey=components/**/*.tsx

# Interfaces vacías - Normal en TypeScript para tipos base (S4023)
sonar.issue.ignore.multicriteria.emptyinterface1.ruleKey=typescript:S4023
sonar.issue.ignore.multicriteria.emptyinterface1.resourceKey=**/interfaces/**

# Ternarios anidados en JSX (S3358) - Común y aceptable en React/JSX
# En JSX es idiomático y más legible que if/else
sonar.issue.ignore.multicriteria.ternary1.ruleKey=typescript:S3358
sonar.issue.ignore.multicriteria.ternary1.resourceKey=**/*.tsx

# Ternarios anidados en formatters (S3358) - Lógica de formato específica
sonar.issue.ignore.multicriteria.ternary2.ruleKey=typescript:S3358
sonar.issue.ignore.multicriteria.ternary2.resourceKey=utils/formatters/**/*.ts

# Números mágicos en constantes y design tokens (S109)
sonar.issue.ignore.multicriteria.constants1.ruleKey=typescript:S109
sonar.issue.ignore.multicriteria.constants1.resourceKey=constants/**

# Archivos de layout de Expo Router (complejidad necesaria) (S3776)
sonar.issue.ignore.multicriteria.layoutfiles1.ruleKey=typescript:S3776
sonar.issue.ignore.multicriteria.layoutfiles1.resourceKey=app/_layout.tsx

# Componentes SVG importados con minúsculas (S6770) - Falso positivo con íconos
# Los íconos SVG de react-native-svg-icons vienen en camelCase por diseño
sonar.issue.ignore.multicriteria.svgicons1.ruleKey=typescript:S6770
sonar.issue.ignore.multicriteria.svgicons1.resourceKey=**/*.tsx

# APIs deprecated de React Native Reanimated (S1874) - runOnJS
# Aún necesario para worklets hasta que haya alternativa estable
sonar.issue.ignore.multicriteria.deprecated1.ruleKey=typescript:S1874
sonar.issue.ignore.multicriteria.deprecated1.resourceKey=components/animated-splash-screen.tsx

# APIs deprecated de React Native (S1874) - blurOnSubmit, Layout
# Aún funcionan y no hay reemplazo claro en algunas versiones de RN
sonar.issue.ignore.multicriteria.deprecated2.ruleKey=typescript:S1874
sonar.issue.ignore.multicriteria.deprecated2.resourceKey=app/cards/**/*.tsx

# Fracciones decimales .0 (S7748) - Constantes numéricas explícitas
# En contexto de diseño/UI, 3.0 puede ser más claro que 3
sonar.issue.ignore.multicriteria.zerofraction1.ruleKey=typescript:S7748
sonar.issue.ignore.multicriteria.zerofraction1.resourceKey=app/cards/**/*.tsx

# Fragment redundante (S6749) - A veces necesario para keys en listas
# React puede requerir Fragment con key incluso con un hijo
sonar.issue.ignore.multicriteria.fragmentredundant1.ruleKey=typescript:S6749
sonar.issue.ignore.multicriteria.fragmentredundant1.resourceKey=**/*.tsx

# Assertion innecesaria (S4325) - Type narrowing necesario
# TypeScript a veces requiere assertions para type guards complejos
sonar.issue.ignore.multicriteria.assertion1.ruleKey=typescript:S4325
sonar.issue.ignore.multicriteria.assertion1.resourceKey=app/cards/**/*.tsx

# useState no destructurado (S6754) - Patrón intencional
# A veces se usa el array completo para pasarlo como prop
sonar.issue.ignore.multicriteria.useState1.ruleKey=typescript:S6754
sonar.issue.ignore.multicriteria.useState1.resourceKey=components/animated-splash-screen.tsx

# ========================================
# Quality Gate
# ========================================

# Esperar resultado del Quality Gate (falla el pipeline si no pasa)
sonar.qualitygate.wait=false

# Desactivar análisis de duplicación en archivos pequeños
# Solo reportar duplicación en archivos > 50 líneas
sonar.cpd.typescript.minimumLines=50
sonar.cpd.javascript.minimumLines=50
